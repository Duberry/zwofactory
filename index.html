<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zwofactory</title>
    <link rel="stylesheet" href="site.css" />
</head> 
<body>
<h1>zwofactory</h1>

<div class="grid">
    <div class="u-1-4">
        <label for="txtName">Name</label>
        <input type="text" id="txtName" autofocus />
    </div>
    <div class="u-1-4">
        <label for="txtAuthor">Author</label>
        <input type="text" id="txtAuthor" />
    </div>
    <div class="u-1-4">
        <label for="txtTags">Tags</label>
        <input type="text" id="txtTags" />
    </div>
    <div class="u-1-4">
        <label for="txtDescription">Description</label>
        <textarea id="txtDescription" rows="2"></textarea>
    </div>
</div>

<div id="divControls" class="grid controls">
    <div class="u-1-10">
        <button class="control z1" data-ftp="50">Z1</button>
    </div>
    <div class="u-1-10">
        <button class="control z2" data-ftp="60">Z2</button>
    </div>
    <div class="u-1-10">
        <button class="control z3" data-ftp="70">Z3</button>
    </div>
    <div class="u-1-10">
        <button class="control z4" data-ftp="80">Z4</button>
    </div>
    <div class="u-1-10">
        <button class="control z5" data-ftp="90">Z5</button>
    </div>
    <div class="u-1-10">
        <button class="control z6" data-ftp="100">Z6</button>
    </div>
    <div class="u-1-10">
        <button class="control wu" data-ftp="">warm up</button>
    </div>
    <div class="u-1-10">
        <button class="control cd" data-ftp="">cool down</button>
    </div>
    <div class="u-1-10">
        <button class="control fr" data-ftp="">free ride</button>
    </div>
    <div class="u-1-10">
        <button class="control te">text event</button>
    </div>
</div>


<div class="grid">
    <div id="divSegmentList" class="u-1-4">
        <div class="grid">
            <div class="u-1-4">% FTP</div>
            <div class="u-1-4">Minutes</div>
        </div>
        <div id="divSegmentTemplate" class="segment grid template">
            <div class="u-1-12 indicator">
                <input type="hidden" />
            </div>
            <div class="u-1-3">
                <input type="number" data-ftp />
            </div>
            <div class="u-1-4">
                <input type="number" data-time />
            </div>
            <div class="u-1-3" style="text-align: center;">
                <button data-direction="up">↑</button>
                <button data-direction="down">↓</button>
                <button data-remove>✗</button>
            </div>
        </div>
    </div>
    <div id="divSegmentChart" class="u-3-4">

    </div>
</div>

<script>
    document.getElementById('divControls').addEventListener('click', function(e) {
        if (e.target.tagName == 'BUTTON') addSegment(e.target);
    });


    document.getElementById('divSegmentList').addEventListener('click', function(e) {
        if (e.target.tagName != 'BUTTON') return;

        var segmentElement = findAncestorByClass(e.target, 'segment'); 

        if (e.target.hasAttribute('data-remove')) {
            removeSegment(segmentElement);
            return;
        }
        
        var direction = e.target.getAttribute('data-direction');
        if (direction == 'up') moveSegmentUp(segmentElement);
        else moveSegmentDown(segmentElement);
    });


    function addSegment(sourceElement) {
        var templ = document.getElementById('divSegmentTemplate');
        var cloned = templ.cloneNode(true);
        cloned.removeAttribute('id');
        cloned.classList.remove('template');
        cloned.querySelector('input[type=hidden]').value = createGuid();
        cloned.querySelector('input[data-ftp]').value = sourceElement.getAttribute('data-ftp');
        cloned.querySelector('div:first-child').classList.add(sourceElement.classList[1]);
        cloned.querySelector('input[data-time]').value = "5";
        document.getElementById('divSegmentList').appendChild(cloned);
        cloned.querySelector('input[type]').select();
    }


    function removeSegment(segmentElement) {
        segmentElement.parentNode.removeChild(segmentElement);
    }


    function moveSegmentUp(segmentElement) {

    }


    function moveSegmentDown(segmentElement) {

    }


    function createGuid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
            return v.toString(16);
        });
    }

    function findAncestorByClass (el, cls) {
        while ((el = el.parentElement) && !el.classList.contains(cls));
        return el;
    }
</script>

</body>
</html>
